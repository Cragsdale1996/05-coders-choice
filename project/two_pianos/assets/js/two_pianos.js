import { Socket } from "phoenix"
import { Piano }  from "./piano"
import { LobbyChannel } from "./lobby_channel"
import { UserChannel } from "./user_channel"

export class TwoPianos{
    
    constructor(){

        if(window.location.pathname === '/')          this.lobby_startup()
        else if(window.location.pathname === '/room') this.room_startup()

    }

    lobby_startup(){

        // Fetch embedded user_id from window (generated by backend)
        this.user_id = window.user_id
        console.log(`user_id: ${this.user_id}`)

        // Set up socket
        this.socket = new Socket("/socket")
        this.socket.connect()

        // Init and join lobby and user channels
        this.channels = {}
        this.channels.lobby = LobbyChannel.setup_and_join(this.socket, this.user_id)
        this.channels.user = UserChannel.setup_and_join(this.socket, this.user_id)

        // Create User's piano (lobby)
        this.pianos        = {}
        this.pianos.mine   = new Piano(1)
        this.pianos.theirs = null

    }

    room_startup(){

    }

}